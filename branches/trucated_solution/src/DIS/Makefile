#############################################################################
# 									    #
# Makefile to compile and link FORTRAN programs                             #
#  									    #
# "make" compiles and links the specified main programs and modules,        #
# using the specified libraries (if any), and produces the executables      #
#									    #
# "make clean" removes all files generated by "make"                        #
#                                                                           #
#############################################################################

all: rmxeq mkxeq
.PHONY: all

# main programs and modules to be compiled 

MAIN = test #test2 test3 NNPDFinterface

MAINROUTINES  = dis_xsec nc_dis cc_dis
FUNCTIONS     = xcoeffunc_cc xcoeffunc_nc xpdfs PDFparam
INTEGRANDS    =	integrands_cc integrands_nc 
NNLOCOEFFFUNC = ZMCoefficientFunctions FF0CoefficientFunctions FFCoefficientFunctions
UTILITIES     = dgauss ddilog wgplg

# List of the modules to include

MODULES = $(MAINROUTINES) $(FUNCTIONS) $(INTEGRANDS) $(NNLOCOEFFFUNC) $(UTILITIES)

# additional libraries

LHLIB = LHAPDF
LHLIBPATH = $(shell lhapdf-config --prefix)/lib

APFELLIB = APFEL
APFELLIBPATH = $(shell apfel-config --prefix)/lib

############################## do not change #############################

SHELL=/bin/bash

FF=gfortran

FFLAGS = -O3 -Wunused #-Wall -Wunused -fPIC

FLINKER=$(FF) 

PGMS= $(MAIN) $(MODULES)

-include $(addsuffix .d,$(PGMS))

# rule to compile source programs

$(addsuffix .o,$(PGMS)): %.o: %.f Makefile
	$(FF) $< -c $(FFLAGS)

# rule to link object files

$(MAIN): %: %.o $(addsuffix .o,$(MODULES)) Makefile
	$(FLINKER) $< $(addsuffix .o,$(MODULES)) $(FFLAGS)  \
        $(addprefix -L,$(LHLIBPATH)) $(addprefix -l,$(LHLIB)) \
        $(addprefix -L,$(APFELLIBPATH)) $(addprefix -l,$(APFELLIB)) -o $@

# produce executables

mkxeq: $(MAIN)

# remove old executables

rmxeq:
	@ -rm -f $(MAIN); \
        echo "delete old executables"		

# clean directory 

clean:
	@ -rm -rf *.o *~  $(MAIN) *.eps *.out *.log *.res*
.PHONY: clean
 
#############################################################################
